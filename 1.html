<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mercado de Servicios - Demo</title>
    <style>
        :root{--bg:#f5f7fb;--card:#fff;--accent:#0b84ff;--muted:#6b7280}
        *{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#0f1724}
        header{background:linear-gradient(90deg,var(--accent),#00b4ff);color:#fff;padding:18px 20px;display:flex;gap:16px;align-items:center;justify-content:space-between}
        .brand{font-weight:700;font-size:18px}
        .controls{display:flex;gap:8px;align-items:center}
        .search{padding:8px 12px;border-radius:8px;border:0;width:260px}
        button{background:#fff;color:var(--accent);border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
        main{max-width:1100px;margin:20px auto;padding:0 16px}
        .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
        .list{display:grid;gap:12px}
        .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 2px rgba(2,6,23,0.06);display:flex;gap:12px;align-items:flex-start}
        .thumb{width:96px;height:72px;border-radius:8px;background:#eef2ff;object-fit:cover}
        .meta{flex:1}
        .title{font-weight:700;margin:0 0 6px}
        .desc{margin:0;color:var(--muted);font-size:14px}
        .tag{display:inline-block;background:#eef2ff;color:var(--accent);padding:4px 8px;border-radius:999px;font-size:12px;margin-right:6px}
        .price{font-weight:700;color:#0b845e}
        .aside{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 2px rgba(2,6,23,0.06)}
        label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
        input[type="text"],input[type="number"],select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef8;margin-top:6px}
        textarea{min-height:100px;resize:vertical}
        .form-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
        .small{font-size:13px;color:var(--muted)}
        .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
        .chip{padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #eef2ff;cursor:pointer;font-size:13px}
        .chip.active{background:var(--accent);color:#fff;border-color:transparent}
        .actions{display:flex;gap:8px;align-items:center}
        .card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
        .btn-danger{background:#ffe9e9;color:#b32121;padding:6px 8px;border-radius:8px;border:0}
        .empty{padding:24px;text-align:center;color:var(--muted);background:var(--card);border-radius:10px}
        @media(max-width:880px){
            .grid{grid-template-columns:1fr}
            .search{width:140px}
        }
    </style>
</head>
<body>
    <header>
        <div class="brand">Mercado de Servicios</div>
        <div class="controls">
            <input id="q" class="search" placeholder="Buscar servicios, p. ej. diseño, programación" />
            <button id="openForm">Ofrecer servicio</button>
        </div>
    </header>

    <main>
        <div class="grid">
            <section>
                <div class="filters">
                    <div class="chip active" data-cat="">Todos</div>
                    <div class="chip" data-cat="Diseño">Diseño</div>
                    <div class="chip" data-cat="Programación">Programación</div>
                    <div class="chip" data-cat="Marketing">Marketing</div>
                    <div class="chip" data-cat="Traducción">Traducción</div>
                    <div class="chip" data-cat="Otro">Otro</div>
                </div>

                <div id="list" class="list"></div>
            </section>

            <aside class="aside">
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <strong>Publicar servicio</strong>
                    <span class="small">Gratis</span>
                </div>

                <form id="form">
                    <label>Título
                        <input type="text" id="title" required placeholder="Título corto del servicio" />
                    </label>

                    <label>Categoría
                        <select id="category">
                            <option>Diseño</option>
                            <option>Programación</option>
                            <option>Marketing</option>
                            <option>Traducción</option>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Crear un select desplegable para los filtros y sincronizarlo con los "chips" existentes
  const filtersContainer = document.querySelector('.filters')
  if (!filtersContainer) return

  const dropdown = document.createElement('select')
  dropdown.id = 'filterDropdown'
  dropdown.style.padding = '8px 10px'
  dropdown.style.borderRadius = '8px'
  dropdown.style.border = '1px solid #eef2ff'
  dropdown.style.background = '#fff'
  dropdown.style.fontSize = '14px'
  dropdown.style.cursor = 'pointer'

  const allOpt = document.createElement('option')
  allOpt.value = ''
  allOpt.textContent = 'Todos'
  dropdown.appendChild(allOpt)

  // Tomar las opciones desde el select de publicación para mantenerlas sincronizadas
  const formCategory = document.getElementById('category')
  const seen = new Set()
  if (formCategory) {
    Array.from(formCategory.options).forEach(o => {
      const txt = o.textContent.trim()
      if (!seen.has(txt)) {
        seen.add(txt)
        const opt = document.createElement('option')
        opt.value = txt
        opt.textContent = txt
        dropdown.appendChild(opt)
      }
    })
  } else {
    // fallback mínimo
    ['Diseño','Programación','Marketing','Traducción','Otro','Finanzas'].forEach(txt => {
      const opt = document.createElement('option')
      opt.value = txt
      opt.textContent = txt
      dropdown.appendChild(opt)
    })
  }
// Responsive behavior: ajusta layout según ancho y añade FAB en móvil para abrir el formulario
function applyResponsiveLayout() {
    const grid = document.querySelector('.grid')
    const formContainer = document.querySelector('aside.aside')
    const search = document.querySelector('.search')
    const header = document.querySelector('header')
    const controls = header ? header.querySelector('.controls') : null
    let fab = document.getElementById('fabOpenForm')
    const dropdown = document.getElementById('filterDropdown')
    const chipsEls = Array.from(document.querySelectorAll('.filters .chip'))

    // Helper para mostrar/ocultar chips y dropdown de filtros
    function showDropdownHideChips() {
        if (dropdown) dropdown.style.display = ''
        chipsEls.forEach(c => c.style.display = 'none')
    }
    function showChipsHideDropdown() {
        if (dropdown) dropdown.style.display = 'none'
        chipsEls.forEach(c => c.style.display = 'inline-block')
    }

    if (window.innerWidth <= 600) {
        // 1-col layout, aside oculto por defecto, search ocupa ancho completo
        if (grid) grid.style.gridTemplateColumns = '1fr'
        if (formContainer) formContainer.style.display = 'none'
        if (search) {
            search.style.width = '100%'
            search.style.marginTop = '8px'
        }
        if (header) {
            header.style.flexDirection = 'column'
            header.style.alignItems = 'stretch'
            header.style.gap = '8px'
        }
        if (controls) controls.style.justifyContent = 'space-between'

        // mostrar dropdown y ocultar chips en móvil
        showDropdownHideChips()

        // Crear FAB para abrir/ocultar el formulario (si no existe)
        if (!fab) {
            fab = document.createElement('button')
            fab.id = 'fabOpenForm'
            fab.title = 'Ofrecer servicio'
            fab.innerText = '＋'
            fab.style.cssText = [
                'position:fixed',
                'right:16px',
                'bottom:16px',
                'width:56px',
                'height:56px',
                'border-radius:999px',
                'background:var(--accent)',
                'color:#fff',
                'border:0',
                'box-shadow:0 6px 18px rgba(2,6,23,0.2)',
                'font-size:28px',
                'display:flex',
                'align-items:center',
                'justify-content:center',
                'z-index:999'
            ].join(';')
            document.body.appendChild(fab)
            fab.addEventListener('click', () => {
                if (!formContainer) return
                const isHidden = formContainer.style.display === 'none' || formContainer.style.display === ''
                // toggle and scroll into view
                formContainer.style.display = isHidden ? 'block' : 'none'
                // if opening, ensure we use single-column layout
                if (isHidden && grid) grid.style.gridTemplateColumns = '1fr'
                if (isHidden) {
                    // focus title for quick input
                    const t = document.getElementById('title')
                    if (t) t.focus()
                    setTimeout(()=> window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 50)
                }
            })
        }
    } else {
        // Desktop / tablet: 2-col layout, aside visible, revert header/search estilos
        if (grid) grid.style.gridTemplateColumns = '1fr 360px'
        if (formContainer) formContainer.style.display = ''
        if (search) {
            search.style.width = ''
            search.style.marginTop = ''
        }
        if (header) {
            header.style.flexDirection = ''
            header.style.alignItems = 'center'
            header.style.gap = ''
        }
        if (controls) controls.style.justifyContent = 'flex-end'
        // mostrar chips y ocultar dropdown en escritorio
        showChipsHideDropdown()
        // eliminar FAB si existe
        if (fab) fab.remove()
    }
}

// Sincronizar selección de chips hacia el dropdown (si existe)
document.addEventListener('click', (e) => {
    const ch = e.target.closest && e.target.closest('.chip')
    const dropdown = document.getElementById('filterDropdown')
    if (ch && dropdown) {
        dropdown.value = ch.dataset.cat || ''
    }
})

// Ejecutar ahora y en cambios de tamaño
applyResponsiveLayout()
window.addEventListener('resize', () => {
    // Debounce simple
    clearTimeout(window.__respTimeout)
    window.__respTimeout = setTimeout(applyResponsiveLayout, 120)
})

  // Insertar el dropdown al principio del contenedor de filtros
  filtersContainer.insertBefore(dropdown, filtersContainer.firstChild)

  // Ocultar visualmente los chips originales (pero dejarlos en DOM para reutilizar los handlers existentes)
  const chips = Array.from(filtersContainer.querySelectorAll('.chip'))
  chips.forEach(c => c.style.display = 'none')

  // Al cambiar el dropdown, "simulamos" el click en el chip correspondiente para reutilizar la lógica ya existente
  dropdown.addEventListener('change', () => {
    const val = dropdown.value
    // buscar chip correspondiente (incluye '' para "Todos")
    const target = document.querySelector(`.chip[data-cat="${val}"]`)
    if (target) {
      target.click()
    } else {
      // si no hay chip (por si), limpiamos selección visual de chips y forzamos render vaciando filtros
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'))
      const first = document.querySelector('.chip[data-cat=""]')
      if (first) first.classList.add('active')
      // disparar evento input en buscador para forzar render (la función render depende del closure; aquí lo mejor es disparar un click en "Todos" si existe)
      if (first) first.click()
    }
  })

  // Inicializar el dropdown si hay un chip activo al cargar
  const active = document.querySelector('.chip.active')
  if (active) {
    dropdown.value = active.dataset.cat || ''
  }
})
</script>
                            <option>Otro</option>
                        </select>
                    </label>

                    <label>Precio (COP)
                        <input type="number" id="price" min="0" step="1" placeholder="0" />
                        
                    </label>

                    <label>Descripción
                        <textarea id="description" placeholder="Describe tu servicio, experiencia y entregables"></textarea>
                    </label>

                    <label>Contacto (email o teléfono)
                        <input type="text" id="contact" placeholder="email@ejemplo.com" />
                    </label>

                    <label>Imagen (opcional)
                        <input type="file" id="image" accept="image/*" />
                        <div id="preview" style="margin-top:8px"></div>
                    </label>

                    <div class="form-actions">
                        <button type="submit">Publicar</button>
                        <button type="button" id="clear" class="btn-danger">Limpiar todo</button>
                    </div>
                </form>

                <p class="small" style="margin-top:12px">Los anuncios se guardan localmente en tu navegador (localStorage). Este demo no envía datos a servidores.</p>
            </aside>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        const STORAGE_KEY = 'ml_servicios_demo_v1'
        const q = document.getElementById('q')
        const listEl = document.getElementById('list')
        const form = document.getElementById('form')
        const openFormBtn = document.getElementById('openForm')
        const clearBtn = document.getElementById('clear')
        const imageInput = document.getElementById('image')
        const preview = document.getElementById('preview')
        const chips = Array.from(document.querySelectorAll('.chip'))

        // Cargar ofertas de localStorage de forma segura (evita crash si el contenido está corrupto)
        let offers = []
        try {
            const raw = localStorage.getItem(STORAGE_KEY)
            offers = raw ? JSON.parse(raw) : []
            if (!Array.isArray(offers)) offers = []
        } catch (err) {
            // Si hay un error al parsear, reiniciamos a array vacío
            offers = []
            console.warn('No se pudo leer STORAGE_KEY, se ha reseteado a []', err)
        }

        let activeCategory = ''
        let searchTerm = ''
        function formatPrice(price) {
            if (!price) return 'Precio a convenir'
            const num = Number(price)
            return '$' + num.toLocaleString('es-CO')
        }
        // --- Auth UI: registro e inicio de sesión ---
        const controls = document.querySelector('.controls')
        if (controls) {
            // helper to update UI when auth state changes
            function getStoredUser(){
            try { return JSON.parse(localStorage.getItem('ml_user_demo') || 'null') } catch { return null }
            }
            function getCurrentUser(){
            try { return JSON.parse(localStorage.getItem('ml_current_user') || 'null') } catch { return null }
            }
            function setCurrentUser(u){
            try { localStorage.setItem('ml_current_user', JSON.stringify(u)) } catch {}
            updateAuthUI()
            }
            function clearCurrentUser(){
            try { localStorage.removeItem('ml_current_user') } catch {}
            updateAuthUI()
            }
            openFormBtn.addEventListener('click', () => {
                const formContainer = document.querySelector('aside.aside');
                formContainer.style.display = formContainer.style.display === 'none' || formContainer.style.display === '' ? 'block' : 'none';
                window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
            });
            // Toggle form visibility and adjust grid layout
            const formContainer = document.querySelector('aside.aside');
            const gridContainer = document.querySelector('.grid');
            let formOpen = false;

            openFormBtn.addEventListener('click', () => {
                formOpen = !formOpen;
                if (formOpen) {
                    formContainer.style.display = 'block';
                    gridContainer.style.gridTemplateColumns = '1fr 360px';
                } else {
                    formContainer.style.display = 'none';
                    gridContainer.style.gridTemplateColumns = '1fr';
                }
                window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
            });
            // container elements we'll toggle
            const regBtn = document.createElement('button')
            regBtn.type = 'button'
            regBtn.id = 'openRegister'
            regBtn.textContent = 'Registrarse'
            const loginBtn = document.createElement('button')
            loginBtn.type = 'button'
            loginBtn.id = 'openLogin'
            loginBtn.textContent = 'Iniciar sesión'

            // user badge + logout (created but hidden initially)
            const userWrap = document.createElement('div')
            userWrap.style.display = 'none'
            userWrap.style.alignItems = 'center'
            userWrap.style.gap = '8px'
            const userNameSpan = document.createElement('span')
            userNameSpan.style.fontWeight = '600'
            const logoutBtn = document.createElement('button')
            logoutBtn.type = 'button'
            logoutBtn.textContent = 'Cerrar sesión'
            logoutBtn.style.background = '#fff'
            logoutBtn.style.color = 'var(--accent)'
            logoutBtn.style.border = '0'
            logoutBtn.style.padding = '6px 8px'
            logoutBtn.style.borderRadius = '8px'
            logoutBtn.addEventListener('click', () => {
            clearCurrentUser()
            })
            userWrap.appendChild(userNameSpan)
            userWrap.appendChild(logoutBtn)

            controls.appendChild(loginBtn)
            controls.appendChild(regBtn)
            controls.appendChild(userWrap)

            // Generic modal builder
            function createModal(html){
            const modal = document.createElement('div')
            modal.style.cssText = 'position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999'
            modal.innerHTML = html
            document.body.appendChild(modal)
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none' })
            return modal
            }

            // --- Register modal ---
            const registerModal = createModal(`
            <div style="background:#fff;padding:18px;border-radius:10px;min-width:320px;max-width:420px;box-shadow:0 6px 24px rgba(2,6,23,0.15)">
            <h3 style="margin:0 0 8px">Registro</h3>
            <form id="registerForm">
            <label style="display:block;margin:8px 0"><input id="r_name" required placeholder="Nombre" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8" /></label>
            <label style="display:block;margin:8px 0"><input id="r_email" type="email" required placeholder="Email" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8" /></label>
            <label style="display:block;margin:8px 0"><input id="r_pass" type="password" required placeholder="Contraseña" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8" /></label>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button type="button" id="cancelRegister" style="background:#ffe9e9;color:#b32121;padding:6px 8px;border-radius:8px;border:0">Cancelar</button>
                <button type="submit">Crear cuenta</button>
            </div>
            </form>
            </div>
            `)
            const registerForm = registerModal.querySelector('#registerForm')
            registerModal.querySelector('#cancelRegister').addEventListener('click', () => registerModal.style.display = 'none')
            regBtn.addEventListener('click', () => {
            registerModal.style.display = 'flex'
            const nameIn = registerModal.querySelector('#r_name')
            if (nameIn) nameIn.focus()
            })
            registerForm.addEventListener('submit', (e) => {
            e.preventDefault()
            const name = registerModal.querySelector('#r_name').value.trim()
            const email = registerModal.querySelector('#r_email').value.trim().toLowerCase()
            const pass = registerModal.querySelector('#r_pass').value
            if (!name || !email || !pass) { alert('Completa todos los campos'); return }
            // Guardar usuario (demo) con contraseña en localStorage (no seguro en producción)
            const user = { id: uid(), name, email, pass, created: Date.now() }
            try { localStorage.setItem('ml_user_demo', JSON.stringify(user)) } catch (err) { console.warn('No se pudo guardar usuario', err) }
            // Auto-login
            try { localStorage.setItem('ml_current_user', JSON.stringify({ id: user.id, name: user.name, email: user.email })) } catch {}
            alert('Registro completado')
            registerModal.style.display = 'none'
            updateAuthUI()
            })

            // --- Login modal ---
            const loginModal = createModal(`
            <div style="background:#fff;padding:18px;border-radius:10px;min-width:320px;max-width:420px;box-shadow:0 6px 24px rgba(2,6,23,0.15)">
            <h3 style="margin:0 0 8px">Iniciar sesión</h3>
            <form id="loginForm">
            <label style="display:block;margin:8px 0"><input id="l_email" type="email" required placeholder="Email" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8" /></label>
            <label style="display:block;margin:8px 0"><input id="l_pass" type="password" required placeholder="Contraseña" style="width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8" /></label>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button type="button" id="cancelLogin" style="background:#ffe9e9;color:#b32121;padding:6px 8px;border-radius:8px;border:0">Cancelar</button>
                <button type="submit">Entrar</button>
            </div>
            </form>
            </div>
            `)
            const loginForm = loginModal.querySelector('#loginForm')
            loginModal.querySelector('#cancelLogin').addEventListener('click', () => loginModal.style.display = 'none')
            loginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex'
            const emailIn = loginModal.querySelector('#l_email')
            if (emailIn) emailIn.focus()
            })
            loginForm.addEventListener('submit', (e) => {
            e.preventDefault()
            const email = loginModal.querySelector('#l_email').value.trim().toLowerCase()
            const pass = loginModal.querySelector('#l_pass').value
            const stored = getStoredUser()
            if (!stored || stored.email !== email || stored.pass !== pass) {
                alert('Credenciales inválidas')
                return
            }
            const safeUser = { id: stored.id, name: stored.name, email: stored.email }
            setCurrentUser(safeUser)
            loginModal.style.display = 'none'
            })

            // Update controls to reflect auth state
            function updateAuthUI(){
            const cur = getCurrentUser()
            if (cur) {
                // hide buttons, show userWrap
                regBtn.style.display = 'none'
                loginBtn.style.display = 'none'
                userWrap.style.display = 'flex'
                userNameSpan.textContent = `Hola, ${cur.name}`
                // prefill contact field in form if present
                const contactIn = document.getElementById('contact')
                if (contactIn) contactIn.value = cur.email
            } else {
                regBtn.style.display = ''
                loginBtn.style.display = ''
                userWrap.style.display = 'none'
                // keep contact as is (don't clear)
            }
            }

            // Initialize auth UI on load
            updateAuthUI()
        }

        // Utility: render image preview
        imageInput.addEventListener('change', e => {
            preview.innerHTML = ''
            const file = e.target.files[0]
            if (!file) return
            const img = document.createElement('img')
            img.className = 'thumb'
            img.style.width = '120px'
            img.style.height = '90px'
            preview.appendChild(img)
            const reader = new FileReader()
            reader.onload = () => img.src = reader.result
            reader.readAsDataURL(file)
        })

        // Render list
        function render() {
            const filtered = offers
                .filter(o => !activeCategory || o.category === activeCategory)
                .filter(o => {
                    if (!searchTerm) return true
                    const s = searchTerm.toLowerCase()
                    return (o.title + ' ' + o.description + ' ' + o.category + ' ' + (o.contact||'')).toLowerCase().includes(s)
                })
                .sort((a,b)=>b.created - a.created)

            listEl.innerHTML = ''
            if (!filtered.length) {
                listEl.innerHTML = '<div class="empty">No hay anuncios. Publica el primero desde la columna derecha.</div>'
                return
            }

            for (const o of filtered) {
                const card = document.createElement('div')
                card.className = 'card'
                const img = document.createElement('img')
                img.className = 'thumb'
                img.src = o.image || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"></svg>'
                img.alt = o.title
                const meta = document.createElement('div')
                meta.className = 'meta'
                meta.innerHTML = `
                    <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
                        <div>
                            <div class="tag">${o.category}</div>
                        </div>
                        <div class="price">${formatPrice(o.price)}</div>
                    </div>
                    <h3 class="title">${escapeHtml(o.title)}</h3>
                    <p class="desc">${escapeHtml(o.description || '')}</p>
                    <div class="card-footer">
                        <div class="small">Contacto: ${escapeHtml(o.contact || '—')}</div>
                        <div class="actions">
                            <button data-id="${o.id}" class="btn-delete btn-danger small">Eliminar</button>
                        </div>
                    </div>
                `
                card.appendChild(img)
                card.appendChild(meta)
                listEl.appendChild(card)
            }
        }

        // Helpers
        function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(offers)) }
        function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2,8) }
        function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])) }

        // Form submit
        form.addEventListener('submit', async e => {
            e.preventDefault()
            const title = document.getElementById('title').value.trim()
            const category = document.getElementById('category').value
            const price = document.getElementById('price').value
            const description = document.getElementById('description').value.trim()
            const contact = document.getElementById('contact').value.trim()

            let imageData = null
            const file = imageInput.files[0]
            if (file) {
                imageData = await readFileAsDataURL(file)
            }

            const newOffer = {
                id: uid(),
                title, category, price, description, contact,
                image: imageData,
                created: Date.now()
            }
            offers.push(newOffer)
            save()
            form.reset()
            preview.innerHTML = ''
            render()
            // scroll to top of list
            window.scrollTo({top:0,behavior:'smooth'})
        })

        // Read file as data URL
        function readFileAsDataURL(file){
            return new Promise((res,rej)=>{
                const r = new FileReader()
                r.onload = ()=>res(r.result)
                r.onerror = rej
                r.readAsDataURL(file)
            })
        }

        // Delete handler (event delegation)
        listEl.addEventListener('click', e => {
            const btn = e.target.closest('.btn-delete')
            if (!btn) return
            const id = btn.getAttribute('data-id')
            if (!confirm('Eliminar este anuncio?')) return
            offers = offers.filter(o=>o.id!==id)
            save()
            render()
        })

        // Clear all
        clearBtn.addEventListener('click', ()=> {
            if (!confirm('Eliminar todos los anuncios guardados localmente?')) return
            offers = []
            save()
            render()
        })

        // Search input
        q.addEventListener('input', e => {
            searchTerm = e.target.value.trim()
            render()
        })

        // Chips filter
        chips.forEach(ch=>{
            ch.addEventListener('click', () => {
                chips.forEach(c=>c.classList.remove('active'))
                ch.classList.add('active')
                activeCategory = ch.dataset.cat || ''
                render()
            })
        })

        // Open simple focus behaviour for "Ofrecer servicio"
        openFormBtn.addEventListener('click', ()=>{
            document.getElementById('title').focus()
            window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'})
        })

        // Initial render
        render()
        })
    </script>
</body>
</html>
